
<!-- Shopping Cart Modal -->
<div class="offcanvas offcanvas-end" id="modalShoppingCart" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Close Button -->
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close">
        <i class="fe fe-x" aria-hidden="true"></i>
    </button>

    <!-- Cart Header -->
    <div class="offcanvas-header lh-fixed fs-lg d-flex justify-content-between align-items-center">
        <strong>Your Cart (<span id="cart-sidebar-count">{{ cart_count|default:"0" }}</span>)</strong>
    </div>

    <!-- Progress Bar for Free Shipping -->
    <div class="px-4 py-2 bg-light">
        <div class="d-flex justify-content-between align-items-center">
            <span class="fs-xs">Spend $50 more to get FREE SHIPPING!</span>
            <span class="fs-xs"><span id="cartSidebarSubtotal">$0.00</span> / $50.00</span>
        </div>
        <div class="progress mt-2" style="height: 5px;">
            <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="50"></div>
        </div>
    </div>

    <!-- Cart Items List -->
    <ul class="list-group list-group-lg list-group-flush" id="cartItemsList">
        <li class="list-group-item text-center text-muted py-4">Loading cartâ€¦</li>
    </ul>

    <!-- Cart Summary -->
    <div class="offcanvas-footer justify-between lh-fixed fs-sm bg-light mt-auto px-4 py-3">
        <strong>Subtotal</strong>
        <strong class="ms-auto" id="cartSidebarSubtotalValue">$0.00</strong>
    </div>

    <!-- Cart Actions -->
    <div class="offcanvas-body d-flex flex-column">
        <a class="btn w-100 btn-dark btn-lg mb-2" href="{% url 'checkout' %}">Proceed to Checkout</a>
        <a class="btn w-100 btn-outline-dark btn-lg" href="{% url 'cart' %}">View Full Cart</a>
        <a class="btn w-100 btn-outline-success mt-3" href="{% url 'shop' %}">
            <i class="fe fe-arrow-left"></i> Continue Shopping
        </a>
    </div>

    <!-- JavaScript for cart item removal -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('click', function(e) {
                const btn = e.target.closest('.remove-item');
                if (!btn) return;
                const itemId = btn.getAttribute('data-id');
                const cartItemElement = document.getElementById(`cart-item-${itemId}`);

                Swal.fire({
                    title: 'Remove Item?',
                    text: "Are you sure you want to remove this item from your cart?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: 'var(--service-primary, #008751)',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, remove it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(`/cart/remove/${itemId}/`, {
                            method: 'POST',
                            headers: {
                                'X-Requested-With': 'XMLHttpRequest',
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                if (cartItemElement) {
                                    cartItemElement.remove();
                                }

                                if (window.refreshCartSidebar) {
                                    window.refreshCartSidebar();
                                }

                                toast.success('Item removed from cart', { title: 'Success' });
                            } else {
                                toast.error('Failed to remove item', { title: 'Error' });
                            }
                        })
                        .catch(error => {
                            console.error("Error removing item:", error);
                            toast.error('An error occurred', { title: 'Error' });
                        });
                    }
                });
            });
        });
    </script>
</div>
